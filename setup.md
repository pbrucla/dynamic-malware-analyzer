# Initial Setup
We are actively updating the doc, so some things may change but should be good.

**If you're on Windows, use WSL, not Powershell.**

We will be running Panda-re using [Docker](https://www.docker.com/). If you do not have Docker, follow the installation instructions [here](https://docs.docker.com/get-docker/).

PANDA is an open-source Platform for Architecture-Neutral Dynamic Analysis. It has the ability to record and replay executions, allowing the user to perform deep system analysis without actually running the given executable or task themselves.  For more information on PANDA-re, see their [website](https://panda.re/).

To start off this project, we will be making use of some materials provided by PANDA's developers during a 2022 class, along with the base Docker container itself. The given materials are already included in this repository under the `panda_materials`directoy.

## Download Initial Materials
The Panda class materials are too large to reasonably be hosted on Github so you will download them yourself. To download the class materials, visit https://panda.re/secret/pc2022.zip and unzip the contents into the `panda_materials/panda_class_materials` folder within this Github repository. Do not commit these files (for now).

## Docker Container Setup
1. Pull the PANDA Docker container from DockerHub via `docker pull pandare/panda`
2. Run the command `docker run -p 5900:5900 -it -v ./panda_materials:/panda_materials --name dynamic-malware-analysis pandare/panda  bash`.  
    * This will run the panda-re container interactively and give it the name "dynamic-malware-analysis" on your machine.
    * All of the materials present in the local "/panda_materials" directory will be present in the Docker container's "/panda_materials" directory.
    * You will enter as root into the container. Exit using `exit`.
3. From now on, to re-run this container, call `docker start -i dynamic-malware-analysis`

## Running the Linux qcow2
To run the initial Linux qcow2, call this command from **within your docker container**
```
panda-system-i386 -nographic /panda_materials/panda_class_materials/qcows/wheezy.qcow2 
```
If this does not work, `exit`, then run
```
docker stop dynamic-malware-analysis
docker rm dynamic-malware-analysis
```
then restart at Docker Container Setup (assuming you downloaded an extracted already) 

otherwise 

Boot in normal mode. Once the boot succeeds, log in with the credentials:
* username = root
* password = root

To return to the base Docker container after booting up panda, type:
* Ctrl+A, C
* quit

## Running the Windows qcow2
Before running the Windows qcow2, you need to download it. This is also hosted separately from this repo (due to size) and can be found [here](https://drive.google.com/drive/folders/1cmez7ACxIuyGif2c2UvGLqXe2cZt3190?usp=drive_link)
To run the Windows qcow2 from within Docker, you will need a VNC viewer. I use TightVNC which you can download [here](https://www.tightvnc.com/download.php)
You will also need to configure loopback connections. To do this, open TightVNC Service Control Interface, click the "Access Control" tab, and ensure that "Allow Loopback connections is checked".

Run the following command from within your Docker container: 
```
panda-system-i386 -monitor stdio -show-cursor -m 8192 -vnc 0.0.0.0:0,to=99,id=default ./panda_materials/panda_class_materials/qcows/mydisk.qcow2
```
Then, boot up TightVNC Viewer on your host machine and connect to the address `0.0.0.0::5900`. Your Windows machine should begin to boot up!
Note: You may need to do some initial repairs to boot the machine. However, once that is done, everything should be good to go! You can interact with the Windows machine via the VNC viewer and with PANDA-re via the commandline in your Docker container.
